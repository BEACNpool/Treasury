<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cardano Treasury — Flows Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
</head>
<body>
  <header class="top">
    <div class="wrap">
      <h1>Cardano Treasury — Flows Dashboard</h1>
      <p class="sub">
        Open research by <a href="https://github.com/BEACNpool" target="_blank" rel="noreferrer">BEACNpool</a>:
        fees, estimated treasury inflows, withdrawals, and treasury balance delta.
      </p>
      <nav class="nav">
        <a href="https://github.com/BEACNpool/Treasury" target="_blank" rel="noreferrer">GitHub</a>
        <a href="https://github.com/BEACNpool/Treasury/blob/main/docs/methodology.md" target="_blank" rel="noreferrer">Methodology</a>
        <a href="https://github.com/BEACNpool/Treasury/blob/main/docs/sources.md" target="_blank" rel="noreferrer">Sources</a>
        <a href="https://github.com/BEACNpool/Treasury/blob/main/docs/data_dictionary.md" target="_blank" rel="noreferrer">Data dictionary</a>
        <a href="https://github.com/BEACNpool/Treasury/blob/main/docs/flag_taxonomy.md" target="_blank" rel="noreferrer">Flag taxonomy</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <!-- Status bar -->
    <section class="card status-card">
      <div class="status-row">
        <div id="status" class="mono">Loading…</div>
        <div class="status-actions">
          <button id="btn-download-year" class="btn-sm" disabled>⬇ Year CSV</button>
          <button id="btn-download-epoch" class="btn-sm" disabled>⬇ Epoch CSV</button>
        </div>
      </div>
    </section>

    <!-- Flags (optional) -->
    <section class="card" id="flags-card" style="display:none">
      <h2>Flags (analysis signals, not accusations)</h2>
      <div id="flags-meta" class="hint"></div>
      <div id="flags-list" class="flags"></div>
      <p class="hint">See <a href="https://github.com/BEACNpool/Treasury/blob/main/docs/flag_taxonomy.md" target="_blank" rel="noreferrer">flag taxonomy</a> for meaning + clearing conditions.</p>
    </section>

    <!-- Tab navigation -->
    <div class="tabs">
      <button class="tab active" data-tab="yearly">Yearly</button>
      <button class="tab" data-tab="epoch">Epoch</button>
    </div>

    <!-- Yearly view -->
    <div id="tab-yearly" class="tab-content active">
      <section class="grid">
        <section class="card">
          <h2>Yearly Overview</h2>
          <div id="chart_yearly" class="chart"></div>
          <p class="hint">Fees, Est. inflow (fees+expansion), Withdrawals (MIR+Conway), Treasury Δ.</p>
        </section>

        <section class="card">
          <h2>Fees vs Withdrawals</h2>
          <div id="chart_fees_withdrawals" class="chart"></div>
          <p class="hint">"Bull market earned vs spent" — explicit withdrawals vs fee revenue.</p>
        </section>
      </section>

      <section class="card">
        <h2>Yearly Data</h2>
        <div class="table-wrap">
          <table id="table-year"></table>
        </div>
      </section>
    </div>

    <!-- Epoch view -->
    <div id="tab-epoch" class="tab-content">
      <section class="grid">
        <section class="card">
          <h2>Treasury Balance (by Epoch)</h2>
          <div id="chart_balance" class="chart"></div>
          <p class="hint">Absolute treasury balance from ada_pots snapshots.</p>
        </section>

        <section class="card">
          <h2>Fee Revenue (by Epoch)</h2>
          <div id="chart_epoch_fees" class="chart"></div>
          <p class="hint">Per-epoch transaction fee revenue.</p>
        </section>
      </section>

      <section class="card">
        <h2>Epoch Data <span id="epoch-count" class="hint"></span></h2>
        <div class="table-wrap">
          <table id="table-epoch"></table>
        </div>
        <p class="hint">Showing most recent 50 epochs. Download CSV for full dataset.</p>
      </section>
    </div>

    <footer class="footer">
      <p>
        Built for reproducibility. Numbers are only as good as their receipts — see
        <a href="https://github.com/BEACNpool/Treasury/blob/main/docs/methodology.md">methodology</a> +
        <a href="https://github.com/BEACNpool/Treasury/blob/main/docs/sources.md">sources</a>.
      </p>
    </footer>
  </main>

  <script src="app.js"></script>
</body>
</html>
