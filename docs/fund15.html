<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BEACN · Fund15 Prep (Ballot + v0 Triage)</title>
  <link rel="stylesheet" href="site.css" />
  <link rel="stylesheet" href="audit-ui.css" />
  <style>
    .kpiGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin:14px 0}
    .kpiBox{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:12px;padding:14px 16px}
    .kpiBox .lbl{font-family:var(--mono);font-size:10px;color:var(--muted2);text-transform:uppercase;letter-spacing:1.4px}
    .kpiBox .val{font-size:22px;font-weight:800;margin-top:6px;letter-spacing:-.3px}
    .kpiBox .note{font-family:var(--mono);font-size:11px;color:var(--muted2);margin-top:6px;line-height:1.35}
    .mono{font-family:var(--mono)}
  </style>
</head>
<body>
  <div class="nav">
    <div class="wrap">
      <div class="brand">BEACN · TREASURY</div>
      <div class="links">
        <a href="./">Dashboard</a>
        <a href="catalyst.html">Catalyst</a>
        <a href="flags.html">Flags</a>
        <a href="ai-audit.html">AI Audit</a>
        <span class="nav-divider">│</span>
        <a href="fund15.html" class="active">Fund15 Prep</a>
        <span class="nav-divider">│</span>
        <a href="https://github.com/BEACNpool/Treasury" target="_blank" rel="noreferrer">GitHub</a>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="h1">Catalyst Fund15 — ballot triage</div>
    <p class="sub">
      Built from the <strong>public Fund15 ballot list</strong>. This is for <strong>pre-vote budgeting + prioritization</strong>.
      It is <strong>not</strong> a claim of wrongdoing.
    </p>

    <div class="audit-callout">
      This page is intentionally blunt: <strong>how many proposals</strong>, <strong>how much is being requested</strong>, and where the asks cluster.
      For historical receipts + delivery patterns, use <a href="catalyst.html">Receipts</a> → <a href="flags.html">Flags</a> → <a href="ai-audit.html">AI Audit</a>.
    </div>

    <div class="disclaimer-banner">
      ⚠ Fund15 flags on this page are v0 heuristics (title-based). They are filters, not verdicts.
    </div>

    <div class="audit-hero" style="text-align:left;">
      <h2>Fund15 snapshot</h2>
      <p id="headline" class="mono" style="margin:0.25rem 0 0 0;">Loading…</p>
      <div class="cta-links" style="justify-content:flex-start;">
        <a href="outputs/offchain/fund15/fund15_voting_ballot_raw.csv" target="_blank" rel="noreferrer">Raw ballot CSV</a>
        <a href="outputs/offchain/fund15/fund15_voting_ballot_clean.csv" target="_blank" rel="noreferrer">Clean ballot CSV</a>
        <a href="outputs/offchain/fund15/fund15_summary.json" target="_blank" rel="noreferrer">Summary (JSON)</a>
        <a href="https://projectcatalyst.io/funds/15" target="_blank" rel="noreferrer">Source</a>
      </div>
    </div>

    <div class="card">
      <div class="h2">Obvious findings (what voters should notice immediately)</div>
      <ul class="note" style="font-size:13px">
        <li><strong id="k_proposals_inline">—</strong> proposals on the ballot.</li>
        <li><strong id="k_ada_req_inline">—</strong> requested in ADA categories (display-only USD estimate at $0.28/ADA).</li>
        <li><strong id="k_cap200_inline">—</strong> proposals ask for exactly <strong>₳200,000</strong> (cap clustering).</li>
        <li><strong id="k_ai_easy_count">—</strong> proposals are tagged as <strong>AI-compressible / content-like</strong> by v0 heuristics.</li>
      </ul>
      <div class="disclaimer-banner" style="margin-top:12px">
        ⚠ The “AI-compressible / content-like” count is a <strong>filter</strong>. It is not a claim the work is worthless.
        It means: <strong>assume the marginal production cost is collapsing</strong> and demand tighter scope + receipts.
      </div>
    </div>

    <div id="tab_overview">
      <div class="kpiGrid">
        <div class="kpiBox">
          <div class="lbl">Proposals</div>
          <div class="val" id="k_proposals">—</div>
          <div class="note">Ballot list size</div>
        </div>
        <div class="kpiBox">
          <div class="lbl">Requested (ADA categories)</div>
          <div class="val" id="k_ada_req">—</div>
          <div class="note">Sum of requested amounts in non-Midnight categories</div>
        </div>
        <div class="kpiBox">
          <div class="lbl">Requested (Midnight $USDM)</div>
          <div class="val" id="k_usdm_req">—</div>
          <div class="note">Sum of requested amounts in Midnight: Compact DApps</div>
        </div>
        <div class="kpiBox">
          <div class="lbl">200k clustering</div>
          <div class="val" id="k_cap200">—</div>
          <div class="note"># proposals requesting exactly ₳200,000</div>
        </div>
      </div>

      <div class="card">
        <div class="h2">Category totals (requested)</div>
        <div class="note">This is requested, not paid.</div>
        <div class="tableWrap" style="margin-top:10px">
          <table>
            <thead><tr><th>Category</th><th>Proposals</th><th>Total requested</th><th>Share (ADA only)</th></tr></thead>
            <tbody id="cat_rows"></tbody>
          </table>
        </div>
      </div>
    </div>


    <div class="card">
      <div class="h2">AI-compressible (12-month test) — proposed strict guideline</div>
      <div class="note" style="font-size:13px">
        For Fund15 triage, we propose a strict “AI-compressible” guideline:
        <ul>
          <li><strong>YES (AI-compressible):</strong> A competent builder with modern AI tooling can plausibly deliver the core output in &lt;12 months at a fraction of the requested budget (e.g., dashboards, simple bots, basic scrapers, templated sites, content packs, translations, tutorials).</li>
          <li><strong>NO (not AI-compressible):</strong> The core value is not the output text/UI — it’s real-world partnerships, field ops, legal/compliance, audited smart contracts, deep infrastructure, security, or long-running operations.</li>
        </ul>
        If a proposal falls in the YES bucket, it’s not “bad” — it just means voters should demand:
        <strong>smaller budget</strong>, <strong>tighter scope</strong>, <strong>faster milestones</strong>, and <strong>public receipts</strong>.
      </div>
      <div class="note" style="margin-top:10px">
        Download the ballot CSV and filter by heuristics: <a href="outputs/offchain/fund15/fund15_voting_ballot_clean.csv" target="_blank" rel="noreferrer">fund15_voting_ballot_clean.csv</a>
      </div>
    </div>

    <div class="card">
      <div class="h2">AI-themed proposals (the irony)</div>
      <div class="note" style="font-size:13px">
        Counted by title keywords (<code>AI</code>, <code>ML</code>, <code>LLM</code>, <code>bot</code>, <code>agent(s)</code>) in ADA-funded categories.
        <strong>Not</strong> a value judgment — just a spotlight: the treasury is being asked to fund AI tools that could plausibly build many other proposals on the same ballot.
      </div>
      <div class="kpiGrid">
        <div class="kpiBox">
          <div class="lbl">AI-themed proposals</div>
          <div class="val" id="k_ai_title_count">—</div>
          <div class="note">title mentions AI/ML/bot/agent</div>
        </div>
        <div class="kpiBox">
          <div class="lbl">Total requested (AI-themed)</div>
          <div class="val" id="k_ai_title_sum">—</div>
          <div class="note">sum of requested (ADA categories)</div>
        </div>
      </div>

      <div class="h3">Top AI-themed asks (receipts)</div>
      <div class="tableWrap" style="margin-top:10px">
        <table>
          <thead><tr><th>Proposal</th><th>Category</th><th>Requested</th><th>Receipt</th></tr></thead>
          <tbody id="ai_title_top"></tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <div class="h2">Partners Tier‑1 problem (budget concentration)</div>
      <div class="note" style="font-size:13px">
        This category is only a small slice of the ballot, but it consumes an outsized share of requested ADA.
        These proposals may have real relationship value — but they also include substantial software/integration work whose costs are deflating rapidly.
      </div>
      <div class="kpiGrid">
        <div class="kpiBox">
          <div class="lbl">Partners proposals</div>
          <div class="val" id="k_partners_count">—</div>
          <div class="note">Cardano Partners: Tier‑1 Enterprise Integrations</div>
        </div>
        <div class="kpiBox">
          <div class="lbl">Partners requested (total)</div>
          <div class="val" id="k_partners_sum">—</div>
          <div class="note">total requested (ADA)</div>
        </div>
        <div class="kpiBox">
          <div class="lbl">Share of requested ADA</div>
          <div class="val" id="k_partners_share">—</div>
          <div class="note">of ADA categories total</div>
        </div>
        <div class="kpiBox">
          <div class="lbl">Average ask</div>
          <div class="val" id="k_partners_avg">—</div>
          <div class="note">mean requested (ADA)</div>
        </div>
      </div>

      <div class="h3">Top Partners asks (receipts)</div>
      <div class="tableWrap" style="margin-top:10px">
        <table>
          <thead><tr><th>Proposal</th><th>Requested</th><th>Receipt</th></tr></thead>
          <tbody id="partners_top"></tbody>
        </table>
      </div>
    </div>

  </div>

<script>
const ADA_PRICE = 0.28; // simple display-only; change anytime

function fmt(n, digits=0){
  return Number(n).toLocaleString(undefined,{maximumFractionDigits:digits});
}

async function loadCSV(path){
  const res = await fetch(path);
  const text = await res.text();
  const lines = text.trim().split(/\r?\n/);
  const headers = lines[0].split(',');
  return lines.slice(1).map(line => {
    const cols=[]; let cur='', inQ=false;
    for (let i=0;i<line.length;i++){
      const ch=line[i];
      if (ch==='"'){ inQ=!inQ; continue; }
      if (ch===',' && !inQ){ cols.push(cur); cur=''; }
      else cur+=ch;
    }
    cols.push(cur);
    const obj={};
    headers.forEach((h,i)=>obj[h]=cols[i]);
    return obj;
  });
}

function isMidnight(cat){
  return (cat||'') === 'Midnight: Compact DApps';
}

async function main(){
  const rows = await loadCSV('outputs/offchain/fund15/fund15_voting_ballot_clean.csv');

  const proposals = rows.length;
  let adaReq=0, usdmReq=0;
  let cap200=0;
  let aiLike=0, contentLike=0;
  let aiInTitle=0;

  const cats={};
  for (const r of rows){
    const cat=r.category||'';
    const amt=Number(r.requested_amount||0);
    const title=r.proposal_title||'';

    cats[cat] = cats[cat] || {count:0,sum:0};
    cats[cat].count += 1;
    cats[cat].sum += amt;

    if (isMidnight(cat)) usdmReq += amt;
    else adaReq += amt;

    if (!isMidnight(cat) && Math.abs(amt-200000) < 1e-6) cap200 += 1;
    if (Number(r.flag_f_ai_001||0)===1) aiLike += 1;
    if (Number(r.flag_f_cat_002||0)===1) contentLike += 1;
    if (/\bAI\b/i.test(title)) aiInTitle += 1;
  }

  // headline
  const usd = adaReq * ADA_PRICE;
  document.getElementById('headline').textContent = `${proposals} proposals · requesting ₳${fmt(adaReq)} (≈ $${fmt(usd)}) + $USDM ${fmt(usdmReq)}.`;

  // overview KPIs
  document.getElementById('k_proposals').textContent = fmt(proposals);
  document.getElementById('k_ada_req').textContent = `₳${fmt(adaReq)}`;
  document.getElementById('k_usdm_req').textContent = `$USDM ${fmt(usdmReq)}`;
  document.getElementById('k_cap200').textContent = fmt(cap200);

  // obvious findings + AI-easy estimate
  const aiEasy = rows.filter(r => Number(r.flag_f_ai_001||0)===1 || Number(r.flag_f_cat_002||0)===1).length;

  const elProposalsInline = document.getElementById('k_proposals_inline');
  const elAdaInline = document.getElementById('k_ada_req_inline');
  const elCap200Inline = document.getElementById('k_cap200_inline');
  const elAiEasy = document.getElementById('k_ai_easy_count');

  if (elProposalsInline) elProposalsInline.textContent = fmt(proposals);
  if (elAdaInline) elAdaInline.textContent = `₳${fmt(adaReq)} (≈ $${fmt(usd)})`;
  if (elCap200Inline) elCap200Inline.textContent = fmt(cap200);
  if (elAiEasy) elAiEasy.textContent = fmt(aiEasy);

  // categories table
  const tbody=document.getElementById('cat_rows');
  const entries=Object.entries(cats);
  entries.sort((a,b)=> (b[1].sum||0) - (a[1].sum||0));
  for (const [name, meta] of entries){
    const tr=document.createElement('tr');
    const sumFmt = isMidnight(name) ? `$USDM ${fmt(meta.sum,2)}` : `₳${fmt(meta.sum,2)}`;
    const share = (!isMidnight(name) && adaReq>0) ? `${((meta.sum/adaReq)*100).toFixed(1)}%` : '—';
    tr.innerHTML = `<td>${name}</td><td class="num">${fmt(meta.count)}</td><td class="num">${sumFmt}</td><td class="num">${share}</td>`;
    tbody.appendChild(tr);
  }

  // AI-themed (title keyword search) + receipts table
  const aiTitleRe = /\b(ai|ml|llm|bot|agent|agents)\b/i;
  const aiHits = rows
    .filter(r => !isMidnight(r.category))
    .filter(r => aiTitleRe.test(r.proposal_title||''))
    .map(r => ({
      title: r.proposal_title||'',
      cat: r.category||'',
      amt: Number(r.requested_amount||0),
      url: r.url||''
    }));
  const aiTitleCount = aiHits.length;
  const aiTitleSum = aiHits.reduce((s,x)=>s+x.amt,0);

  const elAiTitleCount = document.getElementById('k_ai_title_count');
  const elAiTitleSum = document.getElementById('k_ai_title_sum');
  if (elAiTitleCount) elAiTitleCount.textContent = fmt(aiTitleCount);
  if (elAiTitleSum) elAiTitleSum.textContent = `₳${fmt(aiTitleSum)}`;

  const aiTop = document.getElementById('ai_title_top');
  aiHits.sort((a,b)=>b.amt-a.amt);
  for (const x of aiHits.slice(0, 12)){
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${x.title}</td><td>${x.cat}</td><td class="num">₳${fmt(x.amt,2)}</td><td>${x.url?`<a href="${x.url}" target="_blank" rel="noreferrer">receipt</a>`:''}</td>`;
    aiTop.appendChild(tr);
  }

  // Partners tier-1 concentration
  const partners = rows
    .filter(r => (r.category||'') === 'Cardano Partners: Tier-1 Enterprise Integrations')
    .map(r => ({title:r.proposal_title||'', amt:Number(r.requested_amount||0), url:r.url||''}));
  const pCount = partners.length;
  const pSum = partners.reduce((s,x)=>s+x.amt,0);
  const pShare = adaReq>0 ? (pSum/adaReq)*100 : 0;
  const pAvg = pCount ? pSum/pCount : 0;

  const elPCount=document.getElementById('k_partners_count');
  const elPSum=document.getElementById('k_partners_sum');
  const elPShare=document.getElementById('k_partners_share');
  const elPAvg=document.getElementById('k_partners_avg');
  if (elPCount) elPCount.textContent = fmt(pCount);
  if (elPSum) elPSum.textContent = `₳${fmt(pSum)}`;
  if (elPShare) elPShare.textContent = `${pShare.toFixed(1)}%`;
  if (elPAvg) elPAvg.textContent = `₳${fmt(pAvg,0)}`;

  const pTop=document.getElementById('partners_top');
  partners.sort((a,b)=>b.amt-a.amt);
  for (const x of partners.slice(0, 12)){
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${x.title}</td><td class="num">₳${fmt(x.amt,2)}</td><td>${x.url?`<a href="${x.url}" target="_blank" rel="noreferrer">receipt</a>`:''}</td>`;
    pTop.appendChild(tr);
  }
}

main();
</script>
</body>
</html>
